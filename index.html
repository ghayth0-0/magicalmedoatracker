<!DOCTYPE html>
<html>
<head>
    <base href="." />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magical Media Tracker</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <div class="overlay" :class="{ active: isSearchFocused }" @click="unfocusSearch"></div>
        <header>
            <h1><i class="fas fa-magic"></i> Magical Media Tracker</h1>
            <button @click="toggleTheme" class="theme-toggle btn">
                <i :class="isDarkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
                {{ isDarkMode ? 'Light Mode' : 'Dark Mode' }}
            </button>
            <div class="search-bar" :class="{ focused: isSearchFocused }">
                <input 
                    v-model="searchQuery" 
                    @input="debouncedSearch" 
                    @focus="focusSearch"
                    placeholder="Search for movies and TV shows..."
                    type="text"
                >
                <div v-if="(searchResults.length && searchQuery) || isLoading || searchError" class="search-results">
                    <div v-if="isLoading" class="search-result-item">
                        <i class="fas fa-spinner fa-spin"></i> Searching...
                    </div>
                    <div v-else-if="searchError" class="search-result-item error">
                        <i class="fas fa-exclamation-circle"></i> {{ searchError }}
                    </div>
                    <div 
                        v-else
                        v-for="result in searchResults" 
                        :key="result.id"
                        @click="addToWatchlist(result, $event)"
                        class="search-result-item">
                        <img 
                            :src="result.poster_path ? `https://image.tmdb.org/t/p/w92${result.poster_path}` : ''" 
                            width="46"
                            v-if="result.poster_path"
                        >
                        <div>
                            <strong>{{ result.title || result.name }}</strong>
                            <div>{{ result.release_date || result.first_air_date }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container">
            <div class="tabs">
                <button 
                    v-for="tab in tabs" 
                    :key="tab"
                    :class="['tab', { active: currentTab === tab }]"
                    @click="currentTab = tab"
                >
                    <i :class="tabIcons[tab]"></i> {{ tab }}
                </button>
            </div>
    
            <div v-if="currentTab === 'Home'" class="home-content">
                <div class="section-header">
                    <h2 class="section-title">Trending Movies</h2>
                    <button class="view-toggle" @click="viewMode = viewMode === 'grid' ? 'list' : 'grid'">
                        <i :class="viewMode === 'grid' ? 'fas fa-list' : 'fas fa-th'"></i>
                        {{ viewMode === 'grid' ? 'List View' : 'Grid View' }}
                    </button>
                </div>
    
                <div :class="viewMode === 'grid' ? 'media-grid' : 'media-list'">
                    <div v-for="(movie, index) in trendingMovies" 
                         :key="movie.id" 
                         class="media-card"
                         :style="{'--animation-order': index}"
                         @click="openMediaDetails({...movie, media_type: 'movie'})">
                        <img :src="movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : ''" 
                             class="poster"
                             v-if="movie.poster_path">
                        <div class="content-wrapper" v-if="viewMode === 'list'">
                            <div class="title-section">
                                <h3>{{ movie.title }}</h3>
                                <div class="overview">{{ movie.overview }}</div>
                            </div>
                            <div class="action-buttons">
                                <button @click.stop="quickAddToWatched(movie, $event)" class="btn btn-watchlist">
                                    <i class="fas fa-eye"></i> Seen
                                </button>
                                <button @click.stop="addToWatchlist(movie, $event)" class="btn btn-watchlist">
                                    <i class="fas fa-plus"></i> Watchlist
                                </button>
                            </div>
                        </div>
                        <div v-else>
                            <h3>{{ movie.title }}</h3>
                            <div class="media-details">
                                <p>{{ movie.overview }}</p>
                            </div>
                            <div class="action-buttons">
                                <button @click.stop="quickAddToWatched(movie, $event)" class="btn btn-watchlist">
                                    <i class="fas fa-eye"></i> Seen
                                </button>
                                <button @click.stop="addToWatchlist(movie, $event)" class="btn btn-watchlist">
                                    <i class="fas fa-plus"></i> Watchlist
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
    
                <div class="section-header">
                    <h2 class="section-title">Trending TV Shows</h2>
                    <button class="view-toggle" @click="viewMode = viewMode === 'grid' ? 'list' : 'grid'">
                        <i :class="viewMode === 'grid' ? 'fas fa-list' : 'fas fa-th'"></i>
                        {{ viewMode === 'grid' ? 'List View' : 'Grid View' }}
                    </button>
                </div>
                <div :class="viewMode === 'grid' ? 'media-grid' : 'media-list'">
                    <div v-for="(show, index) in trendingTVShows" 
                         :key="show.id" 
                         class="media-card"
                         :style="{'--animation-order': index}"
                         @click="openMediaDetails({...show, media_type: 'tv'})">
                        <img :src="show.poster_path ? `https://image.tmdb.org/t/p/w500${show.poster_path}` : ''" 
                             class="poster"
                             v-if="show.poster_path">
                        <div class="content-wrapper" v-if="viewMode === 'list'">
                            <div class="title-section">
                                <h3>{{ show.name }}</h3>
                                <div class="overview">{{ show.overview }}</div>
                            </div>
                            <div class="action-buttons">
                                <button @click.stop="quickAddToWatched(show, $event)" class="btn btn-watchlist">
                                    <i class="fas fa-eye"></i> Seen
                                </button>
                                <button @click.stop="addToWatchlist(show, $event)" class="btn btn-watchlist">
                                    <i class="fas fa-plus"></i> Watchlist
                                </button>
                            </div>
                        </div>
                        <div v-else>
                            <h3>{{ show.name }}</h3>
                            <div class="media-details">
                                <p>{{ show.overview }}</p>
                            </div>
                            <div class="action-buttons">
                                <button @click.stop="quickAddToWatched(show, $event)" class="btn btn-watchlist">
                                    <i class="fas fa-eye"></i> Seen
                                </button>
                                <button @click.stop="addToWatchlist(show, $event)" class="btn btn-watchlist">
                                    <i class="fas fa-plus"></i> Watchlist
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
    
                <transition name="fade">
                    <div v-if="showModal" class="modal" @click.self="closeModal">
                        <div class="modal-content" @click.stop>
                            <button class="close-modal" @click="closeModal">Ã—</button>
                            <div class="modal-header">
                                <img :src="selectedMedia?.poster_path ? `https://image.tmdb.org/t/p/w500${selectedMedia.poster_path}` : ''" 
                                     class="modal-poster"
                                     v-if="selectedMedia?.poster_path">
                                <div>
                                    <h2>{{ selectedMedia?.title || selectedMedia?.name }}</h2>
                                    <p>{{ selectedMedia?.overview }}</p>
                                    <div class="media-details">
                                        <p>Release Date: {{ selectedMedia?.release_date || selectedMedia?.first_air_date }}</p>
                                        <p>Rating: {{ selectedMedia?.vote_average }}/10</p>
                                    </div>
                                    <div class="action-buttons">
                                        <button @click="quickAddToWatched(selectedMedia, $event)" class="btn btn-watchlist">
                                            <i class="fas fa-eye"></i> Seen
                                        </button>
                                        <button @click="addToWatchlist(selectedMedia, $event)" class="btn btn-watchlist">
                                            <i class="fas fa-plus"></i> Watchlist
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="similar-media">
                                <h3>Similar Titles</h3>
                                <div class="media-grid">
                                    <div v-for="media in similarMedia" 
                                        :key="media.id" 
                                        class="media-card"
                                        @click="openMediaDetails({...media, media_type: selectedMedia.media_type})">
                                        <img :src="media.poster_path ? `https://image.tmdb.org/t/p/w500${media.poster_path}` : ''" 
                                            class="poster"
                                            v-if="media.poster_path">
                                        <h3>{{ media.title || media.name }}</h3>
                                        <div class="media-details">
                                            <p>{{ media.overview }}</p>
                                        </div>
                                        <div class="action-buttons">
                                            <button @click.stop="quickAddToWatched(media, $event)" class="btn btn-watchlist">
                                                <i class="fas fa-eye"></i> Seen
                                            </button>
                                            <button @click.stop="addToWatchlist(media, $event)" class="btn btn-watchlist">
                                                <i class="fas fa-plus"></i> Watchlist
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </transition>
            </div>
    
            <div v-if="currentTab === 'Watched'" class="media-grid">
                <div v-for="(item, index) in watchedMedia" 
                     :key="item.id" 
                     class="media-card"
                     :style="{'--animation-order': index}">
                    <img :src="item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : ''" 
                         class="poster"
                         v-if="item.poster_path">
                    <h3>{{ item.title || item.name }}</h3>
                    <div class="media-details">
                        <p>{{ item.overview }}</p>
                        <p>Release: {{ item.release_date || item.first_air_date }}</p>
                    </div>
                    <div class="rating">
                        <i v-for="n in 5" 
                           :key="n" 
                           :class="['fas', n <= item.rating ? 'fa-star' : 'fa-star-o']"
                           @click="updateRating(item, n)"
                        ></i>
                    </div>
                    <div class="action-buttons">
                        <button @click="toggleFavorite(item)" class="btn btn-favorite">
                            <i :class="item.favorite ? 'fas fa-heart' : 'far fa-heart'"></i>
                            {{ item.favorite ? 'Favorited' : 'Favorite' }}
                        </button>
                        <button @click="removeMedia(item)" class="btn btn-remove">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                </div>
            </div>
    
            <div v-if="currentTab === 'Watchlist'" class="media-grid">
                <div v-for="(item, index) in watchlist" 
                     :key="item.id" 
                     class="media-card"
                     :style="{'--animation-order': index}">
                    <img :src="item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : ''" 
                         class="poster"
                         v-if="item.poster_path">
                    <h3>{{ item.title || item.name }}</h3>
                    <div class="media-details">
                        <p>{{ item.overview }}</p>
                    </div>
                    <div class="action-buttons">
                        <button @click="moveToWatched(item)" class="btn btn-watchlist">
                            <i class="fas fa-check"></i> Mark Watched
                        </button>
                        <button @click="removeFromWatchlist(item)" class="btn btn-remove">
                            <i class="fas fa-times"></i> Remove
                        </button>
                    </div>
                </div>
            </div>
    
            <div v-if="currentTab === 'Favorites'" class="media-grid">
                <div v-for="(item, index) in favorites" 
                     :key="item.id" 
                     class="media-card"
                     :style="{'--animation-order': index}">
                    <img :src="item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : ''" 
                         class="poster"
                         v-if="item.poster_path">
                    <h3>{{ item.title || item.name }}</h3>
                    <div class="rating">
                        <i v-for="n in item.rating" :key="n" class="fas fa-star"></i>
                    </div>
                    <button @click="toggleFavorite(item)" class="btn btn-favorite">
                        <i class="fas fa-heart-broken"></i> Remove from Favorites
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="app.js"></script>
</body>
</html>